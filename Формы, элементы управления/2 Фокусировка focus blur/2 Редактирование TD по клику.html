<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./2 bagua.css">
    <link rel="stylesheet" href="./2 my.css">
    <title>Document</title>
</head>
<body>
    <p>Кликните на ячейку таблицы, чтобы отредактировать её. Нажмите ОК или ОТМЕНА, когда закончите.</p>

    <table id="bagua-table">
        <tr>
            <th colspan="3">Квадрат <em>Bagua</em>: Направление, Элемент, Цвет, Значение</th>
        </tr>
        <tr>
            <td class="nw"><strong>Северо-Запад</strong>
                <br>Металл
                <br>Серебро
                <br>Старейшины
            </td>
            <td class="n"><strong>Север</strong>
                <br>Вода
                <br>Синий
                <br>Перемены
            </td>
            <td class="ne"><strong>Северо-Восток</strong>
                <br>Земля
                <br>Жёлтый
                <br>Направление
            </td>
        </tr>
        <tr>
            <td class="w"><strong>Запад</strong>
                <br>Металл
                <br>Золото
                <br>Молодость
            </td>
            <td class="c"><strong>Центр</strong>
                <br>Всё
                <br>Пурпурный
                <br>Гармония
            </td>
            <td class="e"><strong>Восток</strong>
                <br>Дерево
                <br>Синий
                <br>Будущее
            </td>
        </tr>
        <tr>
            <td class="sw"><strong>Юго-Запад</strong>
                <br>Земля
                <br>Коричневый
                <br>Спокойствие
            </td>
            <td class="s"><strong>Юг</strong>
                <br>Огонь
                <br>Оранжевый
                <br>Слава
            </td>
            <td class="se"><strong>Юго-Восток</strong>
                <br>Дерево
                <br>Зеленый
                <br>Роман
            </td>
        </tr>

    </table>
    <script>
        let table = document.querySelector('table');
        let editTd;
        table.addEventListener('click', (e) => {
            let target = e.target.closest('.edit-cancel,.edit-ok,td');
            if(!table.contains(target)) return;
            if(target.className == 'edit-cancel') {
                finishEdit(editTd.elem, false)
            } else if(target.className == 'edit-ok') {
                finishEdit(editTd.elem, true);
            } else if( target.nodeName == 'TD' ) {
                if(editTd) return;
                makeEditable(target);
            }
        })

        function makeEditable(td) {
            editTd = {
                elem: td,
                data: td.innerHTML
            };
            td.classList.add('edit-td');

            let textArea = document.createElement('textarea');
            textArea.style.width = td.clientWidth + 'px';
            textArea.style.height = td.clientHeight + 'px';
            textArea.className = 'edit-area';

            textArea.value = td.innerHTML;
            td.innerHTML = '';
            td.appendChild(textArea);
            textArea.focus();

            td.insertAdjacentHTML("beforeEnd",
            '<div class="edit-controls"><button class="edit-ok">OK</button><button class="edit-cancel">CANCEL</button></div>' 
            )
        }
        function finishEdit(td, isOk) {
            if(isOk) {
                td.innerHTML = td.firstChild.value;
            } else {
                td.innerHTML = editTd.data;
            }
            td.classList.remove('edit-td');
            editTd = null;
        }
    </script>
</body>
</html>